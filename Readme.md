# InferQ Dataset – Contributor Guide

Welcome, **InferQ Honours Partner!** 🚀 This README is your one‑stop manual for
setting up the repo, generating & pushing new quantum circuits, and never
downloading more data than you need.

---

## 0  Project snapshot

| Item               | Purpose                                                                 |
| ------------------ | ----------------------------------------------------------------------- |
| `generator/`       | Scripts that **create** circuits                                        |
| `utils/`           | Re‑usable code (feature extractors, utils)                              |
| `circuits/`        | One dir **per circuit**:<br>`<uuid>/` → `meta.json` + `circuit.qpy.dvc` |
| `MANIFEST.parquet` | Master index built from all `meta.json` files                           |
| `.dvc/`            | DVC config – points at the shared bucket                                |

All heavy `.qpy` blobs live **only in the remote bucket**; the repo keeps a
few‑byte pointer file and textual metadata.

---

## 1  Prerequisites (install **once**)

| Tool        | macOS / Linux                                                                 | Windows (PowerShell)    | Why we need it                                                             |       |                                           |
| ----------- | ----------------------------------------------------------------------------- | ----------------------- | -------------------------------------------------------------------------- | ----- | ----------------------------------------- |
| **uv**      | \`curl -Ls [https://astral.sh/uv/install.sh](https://astral.sh/uv/install.sh) | bash\`                  | \`irm [https://astral.sh/uv/install.ps1](https://astral.sh/uv/install.ps1) | iex\` | Python env + super‑fast package installer |
| **DVC**     | `uv pip install "dvc[s3]"` <br>(change `[s3]`→`[azure]` etc.)                 | same                    | Tracks & pushes `.qpy` files to remote                                     |       |                                           |
| **Git LFS** | `brew install git‑lfs`   *or*  `apt install git‑lfs`                          | `choco install git‑lfs` | (Only for the tiny _dev_ subset)                                           |       |                                           |

> **Keys & endpoint** – ask Andrei for the AWS `ACCESS_KEY`, `SECRET_KEY`, and
> bucket URL. Put them in your shell rc or use a `.env` file.

---

## 2  First‑time clone

```bash
# 1 clone code (no big data!)
git clone git@github.com:inferq/inferq-dataset.git
cd inferq-dataset

# 2 create Python env & install deps (seconds)
uv venv --python 3.12
source .venv/bin/activate          # Win: .venv\Scripts\activate
uv pip sync                        # reads requirements.lock

# 3 (optional) pull the tiny dev subset
# dvc pull circuits_dev/**/*qpy.dvc
```

If you **only** want to run generators & push new stuff, you’re done – skip the
pull.

---

## 3  Generating & pushing a new circuit

```bash
# A make a circuit – script prompts write into circuits/<uuid>/
python generator/build_ghz.py 512

# B track the heavy binary (creates .dvc pointer)
dvc add circuits/*/*circuit.qpy

# C rebuild manifest (auto‑hook does this too)
python generator/build_manifest.py

# D commit lightweight files
git add circuits/**/*meta.json circuits/**/*qpy.dvc MANIFEST.parquet
git commit -m "Add 512‑qubit GHZ"

git push          # just code & text

dvc push          # uploads *only* this new .qpy blob
```

That’s it! Other collaborators only see a 2‑kB diff unless they choose to
`dvc pull` your circuit.

---

## 4  Downloading **just one** heavy circuit

```bash
# pulls one file; never fetches the full bucket
 dvc pull circuits/ab12ef34/circuit.qpy.dvc
```

Need stats but not the circuit? Read the master Parquet:

```python
import pandas as pd
df = pd.read_parquet("MANIFEST.parquet")
```

---

## 5  Directory rules & naming

\* Each circuit lives in its own folder `<uuid>/` generated by `uuid.uuid4().hex`.
\* Put **exactly two files** inside:
\* `meta.json` – small metadata
\* `circuit.qpy` (tracked via `.dvc` pointer)
\* Never rename folders after commit; UUID is immutable key.

---

## 6  Troubleshooting

| Symptom                              | Fix                                                                       |
| ------------------------------------ | ------------------------------------------------------------------------- |
| `dvc push` asks for creds            | Export `AWS_ACCESS_KEY_ID` + `AWS_SECRET_ACCESS_KEY` (or Azure SAS token) |
| Merge conflict in `MANIFEST.parquet` | Run `python generator/build_manifest.py`, `git add`, then re‑commit       |
| “file already tracked by DVC”        | Remove duplicate `dvc add` or use unique UUID dirs                        |

---

## 7  Updating dependencies

```bash
uv pip up --upgrade                 # upgrades all pinned wheels
uv pip compile requirements.in -o requirements.lock
uv pip sync
```

Commit both `requirements.in` & `requirements.lock`.

---

## 8  FAQ

> **Q Do I ever need to run `dvc pull`?**
> Only if you want to **simulate / inspect** an existing heavy circuit.
>
> **Q What if I’m offline?**
> All generators, feature extractors and tests work with _zero_ remote data.
>
> **Q Can I use Google Cloud / MinIO instead of S3?**
> Yes – owner will change the default remote in `.dvc/config`.

---
